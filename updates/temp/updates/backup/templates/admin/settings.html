{% extends "admin/layout.html" %}

{% block admin_content %}
<div class="card">
    <h2>Temple Settings</h2>
    <form method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="name_mal">Temple Name (Malayalam) *</label>
            <input type="text" id="name_mal" name="name_mal" value="{{ settings.name_mal }}" required
                placeholder="ക്ഷേത്ര നാമം">
        </div>

        <div class="form-group">
            <input type="text" id="name_eng" name="name_eng" value="{{ settings.name_eng }}" placeholder="Temple Name">
        </div>

        <div class="form-group">
            <label for="logo">Temple Logo (Optional)</label>
            <div style="display: flex; align-items: center; gap: 1rem;">
                {% if settings.logo_path %}
                <img src="{{ url_for('static', filename=settings.logo_path) }}" alt="Current Logo"
                    style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%; border: 1px solid #ddd;">
                {% endif %}
                <input type="file" id="logo" name="logo" accept="image/*" style="border: none; padding: 0;">
            </div>
            <p style="font-size: 0.8rem; color: #666; margin-top: 4px;">Upload a square image (PNG/JPG) for best
                results.</p>
        </div>

        <div class="form-group">
            <label for="place">Place / District</label>
            <input type="text" id="place" name="place" value="{{ settings.place }}" placeholder="Place">
        </div>

        <div class="form-group">
            <label for="subtitle_mal">Subtitle (Malayalam)</label>
            <input type="text" id="subtitle_mal" name="subtitle_mal" value="{{ settings.subtitle_mal or '' }}"
                placeholder="ഉപശീർഷകം">
        </div>

        <div class="form-group">
            <label for="subtitle_eng">Subtitle (English) / Reg No.</label>
            <input type="text" id="subtitle_eng" name="subtitle_eng" value="{{ settings.subtitle_eng or '' }}"
                placeholder="Subtitle / Reg No">
        </div>

        <div class="form-group">
            <label for="receipt_footer">Receipt Footer Message</label>
            <textarea id="receipt_footer" name="receipt_footer" rows="2"
                style="width: 100%; border: 1px solid #e2e8f0; border-radius: 4px; padding: 8px;">{{ settings.receipt_footer }}</textarea>
        </div>

        <div class="form-group">
            <label for="color_theme">Color Theme</label>
            <select id="color_theme" name="color_theme" style="width: 100%;">
                <option value="kerala" {% if settings.color_theme=='kerala' or not settings.color_theme %}selected{%
                    endif %}>
                    Kerala Temple (Kumkum & Chandan)
                </option>
                <option value="modern_blue" {% if settings.color_theme=='modern_blue' %}selected{% endif %}>
                    Modern Blue
                </option>
                <option value="royal_purple" {% if settings.color_theme=='royal_purple' %}selected{% endif %}>
                    Royal Purple
                </option>
                <option value="traditional_saffron" {% if settings.color_theme=='traditional_saffron' %}selected{% endif
                    %}>
                    Traditional Saffron
                </option>
                <option value="forest_harmony" {% if settings.color_theme=='forest_harmony' %}selected{% endif %}>
                    Forest Harmony
                </option>
                <option value="ocean_breeze" {% if settings.color_theme=='ocean_breeze' %}selected{% endif %}>
                    Ocean Breeze
                </option>
                <option value="sunset_glow" {% if settings.color_theme=='sunset_glow' %}selected{% endif %}>
                    Sunset Glow
                </option>
                <option value="custom" {% if settings.color_theme=='custom' %}selected{% endif %}>
                    Custom Theme
                </option>
            </select>

            <!-- Custom Theme Colors (Hidden by default) -->
            <div id="custom-theme-colors"
                style="margin-top: 1rem; padding: 1rem; border: 1px dashed #ccc; border-radius: 8px; display: none;">
                <h4 style="margin-bottom: 0.5rem; font-size: 0.9rem;">Custom Colors</h4>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 120px;">
                        <label for="custom_primary" style="font-size: 0.8rem;">Primary</label>
                        <input type="color" id="custom_primary" name="custom_primary"
                            value="{{ settings.custom_theme_colors|default('{}')|from_json|attr('primary')|default('#000000') if settings.custom_theme_colors else '#000000' }}"
                            style="width: 100%; height: 40px; padding: 0; border: none;">
                    </div>
                    <div style="flex: 1; min-width: 120px;">
                        <label for="custom_secondary" style="font-size: 0.8rem;">Secondary</label>
                        <input type="color" id="custom_secondary" name="custom_secondary"
                            value="{{ settings.custom_theme_colors|default('{}')|from_json|attr('secondary')|default('#ffffff') if settings.custom_theme_colors else '#ffffff' }}"
                            style="width: 100%; height: 40px; padding: 0; border: none;">
                    </div>
                    <div style="flex: 1; min-width: 120px;">
                        <label for="custom_background" style="font-size: 0.8rem;">Background</label>
                        <input type="color" id="custom_background" name="custom_background"
                            value="{{ settings.custom_theme_colors|default('{}')|from_json|attr('background')|default('#f5f5f5') if settings.custom_theme_colors else '#f5f5f5' }}"
                            style="width: 100%; height: 40px; padding: 0; border: none;">
                    </div>
                </div>
            </div>
            <div id="theme-preview"
                style="margin-top: 12px; padding: 16px; border-radius: 8px; display: flex; gap: 8px; flex-wrap: wrap;">
                <div style="width: 60px; height: 40px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: 600;"
                    id="preview-primary">Primary</div>
                <div style="width: 60px; height: 40px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: 600;"
                    id="preview-secondary">Secondary</div>
                <div style="width: 60px; height: 40px; border-radius: 4px; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;"
                    id="preview-bg">Background</div>
                <div style="width: 60px; height: 40px; border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: 600;"
                    id="preview-success">Success</div>
            </div>
        </div>

        <div class="form-group">
            <label for="print_template_content">Print Receipt Template (HTML)</label>
            <p style="font-size: 0.8rem; color: #64748b; margin-top: -4px; margin-bottom: 8px;">
                Use Jinja2 variables: <code>slip.bill_no</code>, <code>slip.devotee_name</code>,
                <code>slip.items</code>, etc.
            </p>
            <textarea id="print_template_content" name="print_template_content" rows="15"
                style="width: 100%; border: 1px solid #e2e8f0; border-radius: 4px; padding: 8px; font-family: monospace; font-size: 13px;">{{ settings.print_template_content }}</textarea>
        </div>

        <div class="form-group" style="display: flex; align-items: center; gap: 8px;">
            <input type="checkbox" id="backup_enabled" name="backup_enabled" style="width: auto;" {% if
                settings.backup_enabled %}checked{% endif %}>
            <label for="backup_enabled" style="margin: 0;">Enable Local Backup (Automated)</label>
        </div>

        <div style="margin-top: 1rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
            <button type="submit" class="btn btn-primary">Save Settings</button>
            <button type="submit" formaction="{{ url_for('admin.trigger_backup') }}" class="btn btn-secondary">Backup
                Now</button>
        </div>
    </form>
</div>




<script>
    // Theme color definitions
    const themes = {
        kerala: {
            primary: '#8B0000',
            secondary: '#DAA520',
            background: '#FDF5E6',
            success: '#2E7D32'
        },
        modern_blue: {
            primary: '#3B82F6',
            secondary: '#F59E0B',
            background: '#F8FAFC',
            success: '#10B981'
        },
        royal_purple: {
            primary: '#7C3AED',
            secondary: '#F59E0B',
            background: '#FAF5FF',
            success: '#059669'
        },
        traditional_saffron: {
            primary: '#FF6B35',
            secondary: '#004E89',
            background: '#FFF8F0',
            success: '#38A169'
        },
        forest_harmony: {
            primary: '#1E4620',
            secondary: '#8FBC8F',
            background: '#F1F8E9',
            success: '#4CAF50'
        },
        ocean_breeze: {
            primary: '#00695C',
            secondary: '#4DB6AC',
            background: '#E0F2F1',
            success: '#00897B'
        },
        sunset_glow: {
            primary: '#BF360C',
            secondary: '#FFAB91',
            background: '#FBE9E7',
            success: '#FF7043'
        }
    };

    // Update theme preview
    function updateThemePreview() {
        const selectedTheme = document.getElementById('color_theme').value;
        const customContainer = document.getElementById('custom-theme-colors');

        if (selectedTheme === 'custom') {
            customContainer.style.display = 'block';

            // Use values from pickers
            const prim = document.getElementById('custom_primary').value;
            const sec = document.getElementById('custom_secondary').value;
            const bg = document.getElementById('custom_background').value;

            document.getElementById('preview-primary').style.backgroundColor = prim;
            document.getElementById('preview-secondary').style.backgroundColor = sec;
            document.getElementById('preview-bg').style.backgroundColor = bg;
            document.getElementById('preview-success').style.backgroundColor = '#4CAF50'; // Default success
        } else {
            customContainer.style.display = 'none';
            const colors = themes[selectedTheme];

            document.getElementById('preview-primary').style.backgroundColor = colors.primary;
            document.getElementById('preview-secondary').style.backgroundColor = colors.secondary;
            document.getElementById('preview-bg').style.backgroundColor = colors.background;
            document.getElementById('preview-success').style.backgroundColor = colors.success;
        }
        document.getElementById('preview-bg').style.color = '#333';
    }

    // Initialize preview on page load
    document.addEventListener('DOMContentLoaded', updateThemePreview);

    // Update preview when theme changes
    document.getElementById('color_theme').addEventListener('change', updateThemePreview);

    // Update preview when custom colors change
    document.getElementById('custom_primary').addEventListener('input', updateThemePreview);
    document.getElementById('custom_secondary').addEventListener('input', updateThemePreview);
    document.getElementById('custom_background').addEventListener('input', updateThemePreview);
</script>

{% endblock %}